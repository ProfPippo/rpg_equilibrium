<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>RPG Escolar</title>

<style>
body{
  font-family:Arial;
  background:#111827;
  color:white;
  padding:20px;
}

button,input{
  padding:6px;
  border-radius:6px;
  border:none;
  margin:3px;
}

.tabs button{background:#1f2937;color:white}
.tabs .ativa{background:#22c55e;color:black}

.card{
  background:#1f2937;
  padding:10px;
  border-radius:10px;
  margin:8px 0;
  display:flex;
  gap:10px;
}

.bar{height:8px;background:#374151;border-radius:10px}
.fill{height:100%;background:#22c55e}

.botoes{display:flex;gap:4px;flex-wrap:wrap;margin-top:4px}
</style>
</head>

<body>

<h1>âš”ï¸ RPG Escolar</h1>

<button onclick="baixar()">ğŸ’¾ Baixar dados</button>
<input type="file" onchange="carregarArquivo(event)">
<span style="font-size:12px">Carregar dados.json</span>

<hr>

<div class="tabs">
  <button onclick="trocarAno('6')" id="tab6">6Âº</button>
  <button onclick="trocarAno('7')" id="tab7">7Âº</button>
  <button onclick="trocarAno('8')" id="tab8">8Âº</button>
  <button onclick="trocarAno('9')" id="tab9">9Âº</button>
</div>

<br>

<input id="nome" placeholder="Nome">
<input id="classe" placeholder="Classe">
<button onclick="addAluno()">Adicionar</button>

<div id="lista"></div>

<script>

let dados = [];
let anoAtual="6";


/* =========================
   CARREGAR dados.json automÃ¡tico
========================= */
fetch("dados.json")
  .then(r=>r.json())
  .then(j=>{
    dados=j;
    render();
  });


/* =========================
   TROCAR ANO
========================= */
function trocarAno(a){
  anoAtual=a;
  document.querySelectorAll(".tabs button").forEach(b=>b.classList.remove("ativa"));
  document.getElementById("tab"+a).classList.add("ativa");
  render();
}


/* =========================
   ADICIONAR
========================= */
function addAluno(){
  const nome=nomeInput.value;
  const classe=classeInput.value;

  if(!nome) return;

  dados.push({
    ano:anoAtual,
    nome,
    classe,
    nivel:1,
    xp:0
  });

  nomeInput.value="";
  classeInput.value="";

  render();
}


/* =========================
   XP
========================= */
function addXP(i,val){
  let a=getAno()[i];
  a.xp+=val;

  while(a.xp>=1000){
    a.xp-=1000;
    a.nivel++;
  }

  render();
}


/* =========================
   EDITAR / EXCLUIR
========================= */
function editar(i){
  let a=getAno()[i];

  const n=prompt("Nome:",a.nome);
  if(!n) return;

  const c=prompt("Classe:",a.classe);

  a.nome=n;
  a.classe=c;

  render();
}

function excluir(i){
  const lista=getAno();
  dados.splice(dados.indexOf(lista[i]),1);
  render();
}


/* =========================
   LISTA POR ANO
========================= */
function getAno(){
  return dados.filter(x=>x.ano===anoAtual);
}


/* =========================
   RENDER
========================= */
function render(){
  lista.innerHTML="";

  getAno()
  .sort((a,b)=>(b.nivel*1000+b.xp)-(a.nivel*1000+a.xp))
  .forEach((a,i)=>{

    let pct=(a.xp/1000)*100;

    lista.innerHTML+=`
      <div class="card">
        <div style="flex:1">
          <strong>${a.nome}</strong> â€” Nv ${a.nivel}<br>
          ${a.classe}

          <div class="bar">
            <div class="fill" style="width:${pct}%"></div>
          </div>

          XP ${a.xp}/1000

          <div class="botoes">
            <button onclick="addXP(${i},5)">+5</button>
            <button onclick="addXP(${i},10)">+10</button>
            <button onclick="addXP(${i},20)">+20</button>
            <button onclick="addXP(${i},30)">+30</button>
            <button onclick="addXP(${i},50)">+50</button>
            <button onclick="editar(${i})">âœï¸</button>
            <button onclick="excluir(${i})">ğŸ—‘ï¸</button>
          </div>
        </div>
      </div>
    `;
  });
}


/* =========================
   SALVAR / CARREGAR ARQUIVO
========================= */
function baixar(){
  const blob=new Blob([JSON.stringify(dados,null,2)],{type:"application/json"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="dados.json";
  a.click();
}

function carregarArquivo(e){
  const reader=new FileReader();
  reader.onload=()=>{
    dados=JSON.parse(reader.result);
    render();
  };
  reader.readAsText(e.target.files[0]);
}

trocarAno("6");

</script>
</body>
</html>
